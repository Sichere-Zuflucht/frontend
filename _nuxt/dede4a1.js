(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{614:function(e,t,n){"use strict";n.r(t);var r=n(5),o=(n(46),n(16),{name:"Coaching",props:{coach:{type:Object,default:function(){}},response:{type:Object,default:function(){}},clickable:{type:Boolean,default:!0},now:{type:Boolean,default:!1}},data:function(){return{selectedDate:null,isDelete:!1,eraseLoading:!1,btn:{error:!1,errorMsg:"",acceptText:this.response?this.response.acceptedDate?"Bezahlt":"Termin verbindlich buchen":null,isDisabled:!1,payButtonLoading:!1},redirectWarning:!1,error:null}},computed:{coachingLiesInPast:function(){var e,t=new Date((null===(e=this.response.acceptedDate)||void 0===e?void 0:e.date)||"");return t.setDate(t.getDate()+1),!!this.response.acceptedDate&&t<=new Date}},methods:{cancel:function(e){var t=this;this.eraseLoading=!0,this.$fire.functions.httpsCallable("request-delete")({docId:e.id,email:e.coachEmail}).then((function(){console.log("erased"),t.isDelete=!1,t.eraseLoading=!1,t.error=null,t.$emit("cancel")})).catch((function(e){t.isDelete=!1,t.eraseLoading=!1,t.error=e,console.log("delete error: ",e)}))},pay:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var data,video;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.payButtonLoading=!0,t.redirectWarning=!0,"RED"!==t.response.videoType){n.next=10;break}return data={method:"getEntrycodes",date:e.date,token:t.$config.redAPI},n.next=6,fetch("https://redclient.redmedical.de/service/video",{method:"POST",header:{"Content-Type":"application/json"},body:JSON.stringify(data)});case 6:n.sent.json().then((function(n){video={codeArzt:"https://video.redmedical.de/#/login?name="+t.response.coach.firstName+" "+t.response.coach.lastName+"&code="+n.codeArzt,codePatient:"https://video.redmedical.de/#/login?name=unbekannt&code="+n.codePatient},t.standardPayment(video,e)})).catch((function(e){console.log("err: ",e)})),n.next=12;break;case 10:video="https://meet.jit.si/"+t.response.coach.firstName.toLowerCase()+"_"+t.response.coach.lastName.toLowerCase()+"_"+t.response.id,t.standardPayment(video,e);case 12:case"end":return n.stop()}}),n)})))()},standardPayment:function(e,t){var n=this;this.$fire.functions.httpsCallable("request-acceptDate")({coachName:this.response.coach.firstName+" "+this.response.coach.lastName,acceptedDate:t,requestId:this.response.id,video:e}).then(Object(r.a)(regeneratorRuntime.mark((function r(){var o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n.payButtonLoading=!1,n.btn.isDisabled=!0,n.response.acceptedDate=t,n.response.video=e,r.next=6,n.$fire.functions.httpsCallable("stripe-payCoaching")({responseID:n.response.id,isDev:n.$config.isDev});case 6:o=r.sent.data,n.$stripe.redirectToCheckout({sessionId:o});case 8:case"end":return r.stop()}}),r)}))))},formatDate:function(e){return new Date(e).toLocaleDateString("de-DE",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}}}),c=n(73),l=n(74),d=n.n(l),v=n(529),h=n(197),m=n(208),f=n(195),_=n(100),y=n(508),D=n(603),k=n(164),w=n(131),C=n(103),x=n(202),L=n(510),V=n(681),B=n(59),component=Object(c.a)(o,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-card",{style:"border: 1px solid "+(e.now?e.$vuetify.theme.themes.light.success:e.$vuetify.theme.themes.light.primary),attrs:{elevation:"2",nuxt:"",dark:e.coachingLiesInPast,ripple:e.clickable,to:e.clickable?"/berater/"+e.coach.id:null,outlined:""}},[n("v-sheet",{staticClass:"d-flex",style:"border-bottom: 1px solid "+(e.now?e.$vuetify.theme.themes.light.success:e.$vuetify.theme.themes.light.primary)+" !important"},[n("v-avatar",{attrs:{color:"primary ma-5",size:"35%"}},[n("v-img",{attrs:{src:e.coach.avatar}})],1),e._v(" "),n("div",{staticClass:"ma-5 ml-2 d-flex flex-column justify-center"},[n("h2",{staticClass:"secondary--text text-h2"},[e._v("\n        "+e._s(e.coach.firstName)+" "+e._s(e.coach.lastName)+"\n      ")]),e._v(" "),n("h3",{staticClass:"mt-2 text-h5"},[e._v("\n        "+e._s(e.coach.info.profession)+"\n      ")])])],1),e._v(" "),e.response?n("v-card-text",[n("p",{staticClass:"text-uppercase font-weight-bold mb-1 mt-2 caption"},[e._v("\n      Vorschläge für einen Online-Beratungstermin\n    ")]),e._v(" "),e.response.coachAnswered?e.response.acceptedDate?n("div",[e.response.payed?n("div",[n("v-btn",{staticClass:"my-2",attrs:{color:"success",target:"_blank",disabled:e.coachingLiesInPast,href:"sicherer Anbieter"===e.response.videoType?e.response.video:e.response.video.codePatient}},[e._v("zum Videocall\n        ")]),e._v(" "),n("v-alert",{attrs:{dark:"",text:"",dense:"",color:"success"}},[e._v("Zugesagt für "+e._s(e.formatDate(e.response.acceptedDate.date))+" um\n          "+e._s(e.response.acceptedDate.time)+"\n        ")])],1):n("div",[n("v-alert",{attrs:{dark:"",color:"error",type:"error"}},[n("p",[e._v("\n            Es liegt (noch) keine Bezahlung vor. Der Bezahlungsprozess kann\n            einige Minuten dauern. Bitte warten Sie ein paar Minuten und laden\n            Sie die Seite dann erneut. Sollte die Fehlermeldung trotzdem noch\n            existieren,\n          ")]),e._v(" "),n("p",{staticClass:"caption mt-2"},[e._v("\n            kontaktieren Sie uns unter:\n            "),n("a",{attrs:{href:"mailto:technik@sichere-zuflucht.de"}},[e._v("\n              technik@sichere-zuflucht.de")])])])],1)]):n("div",[n("v-row",[n("v-col",{attrs:{cols:"12"}},[n("v-select",{staticClass:"my-2",attrs:{items:e.response.suggestions,outlined:"",dense:"","hide-details":"",color:"primary",label:"Bitte wählen"},scopedSlots:e._u([{key:"item",fn:function(t){var r=t.item,o=t.on;return[n("v-list-item",e._g({},o),[n("v-list-item-content",[n("v-list-item-title",{staticClass:"font-weight-bold mb-0"},[e._v("\n                    "+e._s(e.formatDate(r.date))+"\n                  ")]),e._v(" "),n("p",{staticClass:"caption"},[e._v(e._s(r.time)+" Uhr")])],1)],1)]}},{key:"selection",fn:function(t){var r=t.item;return[n("p",[e._v(e._s(e.formatDate(r.date))+" | "+e._s(r.time))])]}}],null,!1,813956706),model:{value:e.selectedDate,callback:function(t){e.selectedDate=t},expression:"selectedDate"}}),e._v(" "),n("p",{staticClass:"font-weight-bold mb-0 my-4"},[e._v("Preis: 50€")]),e._v(" "),n("v-btn",{attrs:{color:"success",loading:e.btn.payButtonLoading,disabled:!e.selectedDate||e.btn.isDisabled,block:""},on:{click:function(t){return e.pay(e.selectedDate)}}},[e._v(e._s(e.btn.acceptText)+"\n          ")]),e._v(" "),e.btn.error?n("v-alert",{attrs:{type:"error"}},[e._v(e._s(e.btn.errorMsg))]):e._e(),e._v(" "),n("p",{staticClass:"caption"},[e._v("\n            Nach der Terminbestätigung wirst du direkt zu unserem\n            Zahlungsanbieter „stripe“ weitergeleitet. Nach deiner Zahlung\n            senden wir dir eine Termin-Bestätigung per E-Mail.\n          ")])],1)],1)],1):n("div",[e._v("\n      Der Coach hat auf deine Anfrage noch nicht reagiert.\n    ")])]):e._e(),e._v(" "),e.now?e._e():n("v-card-actions",{staticClass:"align-stretch pa-4",staticStyle:{"border-top":"1px solid lightgrey"}},[n("v-btn",{attrs:{small:"",color:"primary",outlined:"",nuxt:"",to:"/berater/"+e.response.coachId}},[e._v(e._s(e.coach.id)+" Neue Anfrage stellen\n    ")]),e._v(" "),n("v-dialog",{attrs:{persistent:"","max-width":"290"},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on,o=t.attrs;return[n("v-btn",e._g(e._b({attrs:{small:"",text:"",color:"primary"}},"v-btn",o,!1),r),[e._v("Termin absagen\n        ")])]}}],null,!1,2596266636),model:{value:e.isDelete,callback:function(t){e.isDelete=t},expression:"isDelete"}},[e._v(" "),n("v-alert",{staticClass:"mt-2 ma-2",attrs:{type:"error",color:"error"}},[n("p",[e._v("Wirklich absagen?")]),e._v(" "),n("v-btn",{staticClass:"mr-1",attrs:{light:"",loading:e.eraseLoading},on:{click:function(t){return e.cancel(e.response)}}},[e._v("Ja, absagen\n        ")]),e._v(" "),n("v-btn",{attrs:{light:""},on:{click:function(t){e.isDelete=!1}}},[e._v(" nein")])],1)],1),e._v(" "),e.error?n("v-alert",{attrs:{type:"error",color:"error"}},[e._v(e._s(e.error))]):e._e()],1),e._v(" "),n("v-overlay",{attrs:{value:e.redirectWarning,color:"black",opacity:"0.8"}},[n("p",[e._v("\n      Weiterleitung zu Stripe. Dies kann ein bisschen dauern. Bitte warten...\n    ")])])],1)}),[],!1,null,null,null);t.default=component.exports;d()(component,{VAlert:v.a,VAvatar:h.a,VBtn:m.a,VCard:f.a,VCardActions:_.a,VCardText:_.c,VCol:y.a,VDialog:D.a,VImg:k.a,VListItem:w.a,VListItemContent:C.a,VListItemTitle:C.b,VOverlay:x.a,VRow:L.a,VSelect:V.a,VSheet:B.a})}}]);
//# sourceMappingURL=dede4a1.js.map